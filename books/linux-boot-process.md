# Linuxのブートプロセスを見る

## 第１章　ハードウェア

ブートプロセスを見る前の，予備知識の章．
正直いって覚えきれないので，興味を惹いた部分だけメモする．

### ページング

- 利用可能なモード
  - プロテクトモード
  - IA-32eモード
- Linuxカーネルブート時にCP0レジスタ31bit名のフラグを設定すると有効になる

### "使えない領域"

0xA0000から0xFFFFFまで（640KBから1MB）の領域はメモリホールと呼ばれ，Linuxでは"使えない領域"として扱われている．

この原因は8086 (後述，16bit CPU) のメモリアドレス空間との「互換性」にある．
以下に「Linuxのブートプロセスを見る」図1-49の図「予約された物理アドレス領域」を示す．

```
FFFFF +-----------------+
      | System BIOS ROM |
F0000 +-----------------+
      |                 |
      | Expansion card  |
      |                 |
C8000 +-----------------+
      | Video BIOS ROM  |
C0000 +-----------------+
      |                 |
      | Video RAM       |
      |                 |
A0000 +-----------------+
      |                 |
      |                 |
      | Main Meemory    |
      |                 |
      |                 |
00000 +-----------------+
```

0xA0000, つまり640KB以降のメモリアドレス空間はハードウェア用に割り当てられ，この領域にプログラムをロードしたりデータを保存することは出来ない．

空間の後半部分をハードウェア用に割り当てたことによって，1MB以上のメモリが搭載されるようになっても，「互換性」維持のために0xA0000から0xFFFFFの領域を崩すことが出来ず，以下のようなメモリマップになってしまったという．

```
   MAX +------------------+
       |                  |
       |                  |
       |                  |
       | Main Meemory     |
       |                  |
       |                  |
       |                  |
10FF00 +------------------+
       | High Memory Area |
100000 +------------------+
       | Memory Hole      |
 A0000 +------------------+
       |                  |
       | Main Meemory     |
       |                  |
 00000 +------------------+
出典：「Linuxのブートプロセスを見る」
図1-50　使えない領域（メモリホール）
```

OSがメモリ管理をする場合は，このMemory Holeを避けなければならず，処理の複雑さを招いているそうだ．

### 分からなかった用語・意味を忘れてた単語

- [Intel 8086 - Wikipedia](http://ja.wikipedia.org/wiki/Intel_8086)
  - 16bit マイクロプロセッサ
  - 最初のx84アーキテクチャ(x86-16)
  - アドレスバスは20ビットに、データバスは16ビット
- [Intel 80286 - Wikipedia](http://ja.wikipedia.org/wiki/Intel_80286)
  - 16bit マイクロプロセッサ
  - 8086とソフトウェアと上位互換性を持っている
- [Intel 80386 - Wikipedia](http://ja.wikipedia.org/wiki/Intel_80386)
  - 32bit マイクロプロセッサ
  - IA-32(x86-32)
  - 「i386」はこれを指すらしい
  - 互換CPUにも386が付くらしい
- [EM64T (x64)](http://ja.wikipedia.org/wiki/X64)
  - 別名x86-64, IA-32e等
  - x86アーキテクチャの64bit版
- PAE
  - Physical Address Extension，物理アドレス拡張
  - IA-32アーキテクチャで4GiBを超えるメモリを使用できる技術